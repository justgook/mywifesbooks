---
import { getCollection } from 'astro:content';
import createSlug from "../../../lib/createSlug";

export async function getStaticPaths() {
  const books = await getCollection('books');
  const seriesSet = new Set(books.flatMap(book => createSlug(book.data.series)));
  seriesSet.delete("");
  const series = [...seriesSet];
  
  return series.map(series => ({
    params: { series },
    props: { series }
  }));
}

const { series } = Astro.params;
// Encode URI but preserve + and other common characters
const encodedSeries = encodeURI(series);
return Astro.redirect(`/series/${encodedSeries}/1`, 301);
---
