---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const books = await getCollection('books');
  const tagsSet = new Set(books.flatMap(book => book.data.tags));
  tagsSet.delete("");
  const tags = [...tagsSet];
  
  return tags.map(tag => ({
    params: { tag },
    props: { tag }
  }));
}

const { tag } = Astro.params;
// Encode URI but preserve + and other common characters
const encodedTag = encodeURI(tag);
return Astro.redirect(`/tags/${encodedTag}/1`, 301);
---
